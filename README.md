## 시나리오 선정
콘서트 예약 서비스

### 마일 스톤
https://github.com/users/devssk/projects/1


### 시나리오 요구사항
- 유저 토큰 발급 API
- 예약 가능 날짜 / 좌석 API
- 좌석 예약 요청 API
- 잔액 충전 / 조회 API
- 결제 API

유저 대기열 토큰 기능
- 서비스를 이용할 토큰을 발급받는 API를 작성합니다.
- 토큰은 유저의 UUID 와 해당 유저의 대기열을 관리할 수 있는 정보
  ( 대기 순서 or 잔여 시간 등 ) 를 포함합니다.
- 이후 대기열에 의해 **보호받는** 모든 API 는 위 토큰을 이용해 대기열 검증을 통과해야 이용 가능합니다.
- **내 대기번호를 조회하는 폴링용 API를 작성합니다.**

예약 가능 날짜 / 좌석 API
- 예약가능한 날짜와 해당 날짜의 좌석을 조회하는 API 를 각각 작성합니다.
- 예약 가능한 날짜 목록을 조회할 수 있습니다.
- 날짜 정보를 입력받아 예약가능한 좌석정보를 조회할 수 있습니다.
- 좌석 정보는 1 ~ 50 까지의 좌석번호로 관리됩니다.

좌석 예약 요청 API
- 좌석 예약과 동시에 해당 좌석은 그 유저에게 약 5분간 임시 배정됩니다. ( 시간은 정책에 따라 자율적으로 정의합니다. )
- 날짜와 좌석 정보를 입력받아 좌석을 예약 처리하는 API 를 작성합니다.
- 만약 배정 시간 내에 결제가 완료되지 않는다면 좌석에 대한 임시 배정은 해제되어야 하며
  임시배정 상태의 좌석에 대해 다른 사용자는 예약할 수 없어야 한다.

잔액 충전 / 조회 API
- 결제에 사용될 금액을 API 를 통해 충전하는 API 를 작성합니다.
- 사용자 식별자 및 충전할 금액을 받아 잔액을 충전합니다.
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.

결제 API
- 결제 처리하고 결제 내역을 생성하는 API 를 작성합니다.
- 결제가 완료되면 해당 좌석의 소유권을 유저에게
  배정하고 대기열 토큰을 만료시킵니다.

### 요구사항 분석 및 기능 도출

토큰을 발급 하는 기능
- 토큰을 만든다.
- 한 유저가 여러번의 토큰을 만들 수 있다.(여러번의 대기열 참가 가능하기 위해)

대기열에 해당 토큰을 진입시키는 기능
- 해당 토큰을 대기열에 넣는다.
- 한 유저가 여러개의 토큰으로 여러 대기열에 참가할 수 있다.

대기열 해당 토큰을 만료시키는 기능
- 대기열의 토큰 상태를 바꾼다.

내 대기번호를 조회하는 기능
- 폴링용으로 현재 나의 대기번호가 몇번인지 조회한다.
- 토큰으로 확인해야 한다.

토큰의 대기열 검증 기능
- 이 토큰이 해당 대기열에서 유효한지 확인한다.

토큰의 유효성을 검증하는 기능
- 이 토큰 검증(해당 콘서트가 맞는지 등) 한다.

해당 콘서트의 예약 가능한 날짜를 조회하는 기능
- 해당 콘서트가 존재하는지 검사해야 한다.
- 한 콘서트는 여러개의 예약 가능한 날짜를 가질 수 있다.

해당 콘서트의 해당 날짜의 좌석 정보를 조회하는 기능
- 해당 콘서트가 존재하는지 검사해야 한다.
- 해당 콘서트, 해당 날짜의 좌석 정보(잔여 좌석)를 조회 한다.

좌석을 예약하여 임시로 점유하는 기능
- 해당 콘서트가 존재하는지 검사해야 한다.
- 정책에 따른 시간동안 좌석을 점유해야 한다.(이 시간동안 다른 유저는 접근금지)
- 임시 점유 시간동안 결제가 완료되지 않으면 점유를 해제해야한다.

잔액을 충전하는 기능
- 해당 유저가 존재하는지 검사해야 한다.
- 동시에 충전한다고 했을때 정상적으로 충전 후 잔액이 보여야 한다.

잔액을 조회하는 기능
- 해당 유저가 존재하는지 검사해야 한다.
- 현재 잔액을 보여준다.

결제 하는 기능
- 해당 유저가 존재하는지 검사해야 한다.
- 잔액이 부족하면 결제가 불가하다.
- 동시에 결제한다고 했을때 정상적으로 결제가 진행되어야 한다.

### 플로우 차트
![img1.png](img/img1.png)